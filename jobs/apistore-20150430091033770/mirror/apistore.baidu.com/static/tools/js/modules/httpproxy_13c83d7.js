define("tools:static/js/modules/httpproxy.js",function(e,t){function r(e,t){var r="text/html";return"xml"===t?r="xml":"html"===t&&(r="htmlmixed"),CodeMirror.fromTextArea(e[0],{value:"",lineNumbers:!0,mode:r,theme:"neat",indentUnit:4,lineWrapping:!0,styleActiveLine:!0,matchBrackets:!0,autoCloseBrackets:!0,foldGutter:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],readOnly:!0})}function s(e){var t=!1;switch(e){case"POST":case"PUT":case"PATCH":case"DELETE":case"LINK":case"UNLINK":t=!0;break;default:t=!1}return t}function a(){function e(){return i.empty_check(d,o,"请求地址必填")?i.is_url($.trim(d.val()))?(d.removeClass("border-error"),o.text(""),!0):(d.addClass("border-error"),o.text("请输入正确的URL"),!1):!1}function t(e){var t=!0,r=e.find("input");return r.each(function(){return i.empty_check($(this),o,"请求参数未填写")?void 0:(t=!1,!1)}),t}function a(){return!(!e()||h.filter(":checked").length&&!t(f)||u.filter(":checked").length&&!t(m)||p.filter(":visible").length&&!t(p))}var n=$("#js-tools-block"),o=$("#js-form-error"),l=$("#js-req-method"),d=$("#js-req-url"),c=$("#js-submit-btn"),h=$("#js-url-params"),u=$("#js-headers"),f=$("#js-url-params-block"),m=$("#js-headers-block"),p=$("#js-params-block"),b=$("#js-res-body"),v=r(b),j=$("#js-res-body-block");l.on("change",function(){var e=$(this).val();s(e)?p.show():p.hide()}),h.on("change",function(){$(this).prop("checked")?f.show():f.hide()}),u.on("change",function(){$(this).prop("checked")?m.show():m.hide()}),n.on("click",".js-del",function(){$(this).closest("tr").remove()}),n.on("click",".js-add-param",function(){$(this).siblings("table").find("tbody").append('<tr><td class="td-1"><input type="text" class="form-input" maxlength="100"></td><td class="td-2 clearfix"><input type="text" class="form-input fl" maxlength="300"><span class="btn-del js-del fl ml10">X</span></td></tr>')}),d.on("blur",function(){e()}),n.on("focusout",".js-params-table input",function(){i.empty_check($(this),o,"请求参数未填写")}),c.on("click",function(){var e=$(this),t=[],r=[],s=[];!e.hasClass("disabled")&&a()&&(e.addClass("disabled btn-gray").text("发送中..."),h.filter(":checked").length&&f.find("tbody tr").each(function(){t.push({key:$.trim($(this).find("input").eq(0).val()),value:$.trim($(this).find("input").eq(1).val())})}),u.filter(":checked").length&&m.find("tbody tr").each(function(){r.push({key:$.trim($(this).find("input").eq(0).val()),value:$.trim($(this).find("input").eq(1).val())})}),p.filter(":visible").length&&p.find("tbody tr").each(function(){s.push({key:$.trim($(this).find("input").eq(0).val()),value:$.trim($(this).find("input").eq(1).val())})}),i.ajaxPost("/astore/toolshttpproxysend",{reqMethod:l.val(),reqUrl:$.trim(d.val()),reqBodyParams:s,reqUrlParams:t,reqHeaders:r},function(e){if(e){if(e.responseHeader&&$("#js-res-header").html(decodeURIComponent(e.responseHeader)),e.responseBody){var t=decodeURIComponent(e.responseBody);if(j.show(),e.responseType)switch(e.responseType){case"json":v.setOption("mode","javascript"),t=vkbeautify.json(t,4);break;case"xml":v.setOption("mode","xml"),t=vkbeautify.xml(t);break;default:v.setOption("mode","htmlmixed")}v.setValue(t)}else j.hide();$("html, body").animate({scrollTop:$("#js-http-block").offset().top},500)}},function(e){i.error(e)},function(){i.error("请求失败")},function(){e.removeClass("disabled btn-gray").text("发送")}))})}function n(e){function t(e,t){var r=t.length,s=0,a=e.find("tbody tr").length,n=[],o=e.find(".js-add-param");for(s=r-a;s>0;s--)o.click();for(n=e.find("tbody input"),s=0;r>s;s++)n.eq(2*s).val(t[s].name),n.eq(2*s+1).val(t[s].default_value)}var r="";e.reqMethod&&(r=e.reqMethod.toUpperCase(),$("#js-req-method").val(r).trigger("change"),"POST"===r&&(!e.reqBodyParams||e.reqBodyParams.length<=0)&&$("#js-params-block").find("tbody").children().detach()),e.interface&&($("#js-req-url").val(e.interface),i.is_lt_ie10()&&$("#js-req-url").removeClass("placeholdersjs")),e.reqBodyParams&&e.reqBodyParams.length&&t($("#js-params-block"),e.reqBodyParams),e.reqUrlParams&&e.reqUrlParams.length&&($("#js-url-params").prop("checked",!0).trigger("change"),t($("#js-url-params-block"),e.reqUrlParams)),e.reqHeaders&&e.reqHeaders.length&&($("#js-headers").prop("checked",!0).trigger("change"),t($("#js-headers-block"),e.reqHeaders))}function o(){var e=i.getUrlParam(window.location.href,"apiId");e&&i.ajaxPost("/astore/toolsgetapiparams",{apiId:e},function(e){e&&n(e)},function(e){i.error(e)},function(){i.error("获取API数据失败")})}var i=e("common:static/js/modules/util.js");t.init=function(){a(),o()}});